# ISP 学习路线（可落地版）

本仓库用于配合「从零 ISP + 相机底层」学习计划，按周推进、按天落地。
目标是能够在面试中讲清楚 **相机链路、ISP 模块、驱动结构、bit-true 验证**，并能展示可运行的 C 代码。

---

## 目录结构

```
.
├── driver_notes/          # 驱动与系统笔记（CSI/V4L2/中断/带宽等）
├── isp_c_model/           # C 参考模型与基础算法
├── test_vectors/          # 测试向量/输入输出样例
└── verification/          # 对比器/验证流程
```

> 说明：每周的成果都应当能在这些目录中找到“可运行代码 + 可复现说明”。

---

## 模块化上下文管理（给 AI 助手用）

为避免每次对话加载整个仓库，建议把每个子模块当成独立上下文单元管理：

1) **每个模块目录放 `AGENTS.md` 或 `CONTEXT.md`**
   - 说明该模块用途、入口文件、依赖、以及“只需加载本目录”。
2) **根目录维护模块索引**（见 `MODULES.md`）
   - 记录模块名称 → 路径 → 入口文件 → 说明。

下次需要某个模块时，直接说：
> “只加载 `<模块路径>` 目录即可，优先读该目录的 AGENTS/CONTEXT。”

示例模板可参考：`MODULES.md`。

---

## Week1 目标（第 1-2 周）

**核心目标**：打通相机链路概念与驱动骨架，具备 I2C 配表、V4L2 subdev 基本结构的肌肉记忆。

### Day1 必做任务（已提供代码骨架）

1. **I2C 寄存器表执行器（C）**
   * 关键点：延时控制、寄存器/数据位宽可拓展、错误处理。
2. **RAW10 unpack（C）**
   * 关键点：RAW10 打包方式（5 字节 4 像素）、位宽提升到 16bit、stride/对齐。
3. **最小 BPC（坏点修复）（C）**
   * 关键点：邻域均值/中值、阈值判断、防止误伤边缘、按 Bayer 通道处理。

这些代码位于：`isp_c_model/day1_*.c`，你可以直接编译运行，或者集成到自己的小工程中。

---

## 每日学习节奏建议

- **工作日**：90 分钟（30 分钟概念 + 60 分钟代码）
- **周末**：半天做「周成果整合」

建议每天做一件可验证的小事：

- 运行一个小工具
- 打印结果/统计差异
- 写一段解释文档

这会让你在面试中有“我亲手跑过”的底气。

---

## 本仓库 Week1-Day1 代码使用指引

### 1) I2C 寄存器表执行器
文件：`isp_c_model/day1_i2c_reg_table.c`

**你要能讲清楚**：
- 为什么需要 delay（PLL lock / stream 切换 / group hold）
- 为什么要兼容 8/16 bit reg/val

### 2) RAW10 unpack
文件：`isp_c_model/day1_raw10_unpack.c`

**你要能讲清楚**：
- RAW10 打包方式
- unpack 后转 16bit 的意义（后续 ISP 处理更安全）
- stride/对齐策略（DMA 对齐、行尾 padding）

### 3) 最小 BPC
文件：`isp_c_model/day1_bpc.c`

**你要能讲清楚**：
- 阈值为何必要（避免把真实边缘当坏点）
- Bayer 上要分通道判断

---

## 下一步建议

完成 Day1 后建议继续：

- **Day2**：实现 LSC 网格插值 + 定点化（Q 格式）
- **Day3**：实现 WB + clamp + 饱和处理
- **Day4**：组合 pipeline（RAW10 → BPC → LSC → WB）
- **Day5**：写对比器（最大误差/误差分布/定位）

---

## 运行提示（可选）

你可以用 `gcc` 直接编译单文件运行：

```bash
gcc -O2 -Wall isp_c_model/day1_raw10_unpack.c -o raw10_unpack
./raw10_unpack
```

若需要更完整的工程结构，可后续补 `Makefile` 或 `CMakeLists.txt`。
